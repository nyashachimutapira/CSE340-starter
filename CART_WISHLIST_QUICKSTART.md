# Shopping Cart & Wishlist - Quick Start Guide

## What Was Implemented

A complete shopping cart and wishlist system for the CSE340 vehicle inventory application with:

✅ **Database Tables**
- `shopping_cart` - Stores user cart items with quantities
- `wishlist` - Stores user wishlist items

✅ **Backend Models**
- `cart-model.js` - Cart database operations
- `wishlist-model.js` - Wishlist database operations

✅ **Backend Controllers**
- `cartController.js` - Handles cart views and API endpoints
- `wishlistController.js` - Handles wishlist views and API endpoints

✅ **Routes**
- `/cart` - Cart endpoints
- `/wishlist` - Wishlist endpoints

✅ **Frontend Views**
- `/cart/view.ejs` - Shopping cart display
- `/wishlist/view.ejs` - Wishlist display
- Updated `inventory/detail.ejs` - Add cart/wishlist buttons

## Database Setup

Run this SQL to create the tables:

```sql
-- Already added to database/rebuild.sql
CREATE TABLE IF NOT EXISTS public.shopping_cart (
  cart_id INT GENERATED BY DEFAULT AS IDENTITY,
  account_id INT NOT NULL REFERENCES public.account(account_id) ON DELETE CASCADE,
  inv_id INT NOT NULL REFERENCES public.inventory(inv_id) ON DELETE CASCADE,
  quantity INT NOT NULL DEFAULT 1 CHECK (quantity > 0),
  added_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT shopping_cart_pkey PRIMARY KEY (cart_id),
  CONSTRAINT shopping_cart_unique UNIQUE (account_id, inv_id)
);

CREATE TABLE IF NOT EXISTS public.wishlist (
  wishlist_id INT GENERATED BY DEFAULT AS IDENTITY,
  account_id INT NOT NULL REFERENCES public.account(account_id) ON DELETE CASCADE,
  inv_id INT NOT NULL REFERENCES public.inventory(inv_id) ON DELETE CASCADE,
  added_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT wishlist_pkey PRIMARY KEY (wishlist_id),
  CONSTRAINT wishlist_unique UNIQUE (account_id, inv_id)
);
```

## API Endpoints

### Cart Endpoints

```
GET  /cart              - View cart page
POST /cart/add          - Add item to cart
POST /cart/update-quantity - Update item quantity
POST /cart/remove       - Remove item from cart
POST /cart/clear        - Clear entire cart
```

### Wishlist Endpoints

```
GET  /wishlist          - View wishlist page
POST /wishlist/add      - Add item to wishlist
POST /wishlist/remove   - Remove item from wishlist
```

## Usage Examples

### Add Item to Cart (Frontend)

```javascript
fetch('/cart/add', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ invId: 5, quantity: 1 })
})
.then(response => response.json())
.then(data => {
  if (data.success) {
    alert('Item added to cart!');
  }
});
```

### Add Item to Wishlist (Frontend)

```javascript
fetch('/wishlist/add', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ invId: 5 })
})
.then(response => response.json())
.then(data => {
  if (data.success) {
    alert('Item added to wishlist!');
  }
});
```

## User Flow

### Shopping Cart
1. User logs in and browses vehicles
2. On vehicle detail page, clicks "Add to Cart"
3. Item is added to cart (quantity increases if already present)
4. User can visit `/cart` to view cart
5. From cart, user can:
   - Update quantities
   - Remove individual items
   - Clear entire cart
   - Proceed to checkout (placeholder)

### Wishlist
1. User logs in and browses vehicles
2. On vehicle detail page, clicks "Add to Wishlist"
3. Item is added to wishlist
4. User can visit `/wishlist` to view wishlist
5. From wishlist, user can:
   - View all saved items
   - Add items to cart
   - Remove items from wishlist

## Features

### Cart Features
- ✅ Add items to cart
- ✅ Increase quantity for existing items
- ✅ Update item quantities
- ✅ Remove individual items
- ✅ Clear entire cart
- ✅ View total price
- ✅ Requires authentication

### Wishlist Features
- ✅ Add items to wishlist
- ✅ Prevent duplicate entries
- ✅ View all wishlist items
- ✅ Add items to cart from wishlist
- ✅ Remove items from wishlist
- ✅ Requires authentication

## Authentication

All cart and wishlist operations require:
- User must be logged in (JWT token required)
- Token is checked in `req.account`
- Non-authenticated users are redirected to login

## File Locations

**Models:**
- `models/cart-model.js` (110 lines)
- `models/wishlist-model.js` (68 lines)

**Controllers:**
- `controllers/cartController.js` (170 lines)
- `controllers/wishlistController.js` (105 lines)

**Routes:**
- `routes/cartRoute.js` (18 lines)
- `routes/wishlistRoute.js` (14 lines)

**Views:**
- `views/cart/view.ejs` (170 lines)
- `views/wishlist/view.ejs` (185 lines)
- `views/inventory/detail.ejs` (updated)

**Config:**
- `database/rebuild.sql` (updated)
- `server.js` (updated)
- `utilities/index.js` (updated)
- `controllers/inventoryController.js` (updated)

## Testing

To test the implementation:

1. Start the server
2. Create a user account (login page)
3. Browse vehicles on home page
4. Click on a vehicle to view details
5. Click "Add to Cart" or "Add to Wishlist"
6. Visit `/cart` or `/wishlist` to see your items
7. Test quantity updates and removals
8. Verify totals are calculated correctly

## Future Enhancements

- Checkout process integration
- Payment processing
- Order management
- Cart persistence (save carts)
- Wishlist sharing
- Price drop notifications
- Discount codes

## Troubleshooting

**"Please log in" message when accessing cart/wishlist**
- Ensure user is authenticated
- Check JWT token cookie is present
- JWT token may have expired

**Items not showing in cart/wishlist**
- Verify user ID matches in database
- Check database tables exist
- Verify item ID (invId) is valid

**Quantity not updating**
- Check browser console for errors
- Ensure cart_id is being passed correctly
- Verify database constraints allow updates

**Duplicate items in cart**
- This is expected behavior - quantity increases
- Check database unique constraint on (account_id, inv_id)

## Notes

- Cart and wishlist are tied to user accounts
- Carts are deleted when user account is deleted (cascade)
- Wishlist prevents duplicate items (unique constraint)
- Cart allows increasing quantity for same item
- All timestamps are stored in UTC
- Prices are stored as NUMERIC(9,0) in inventory table

## Support

For issues or questions:
1. Check browser console for JavaScript errors
2. Check server logs for backend errors
3. Review database.rebuild.sql for schema verification
4. Review SHOPPING_CART_IMPLEMENTATION.md for detailed documentation
