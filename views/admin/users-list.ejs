<div class="admin-users-list">
  <h1>Users Management</h1>
  
  <div class="users-stats">
    <p><strong>Total Users:</strong> <%= users.length %></p>
  </div>

  <% if (users && users.length > 0) { %>
    <div class="users-table-container">
      <table class="users-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Account Type</th>
            <th>Member Since</th>
            <th>Profile Completion</th>
            <th>Phone</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% users.forEach(user => { %>
            <tr>
              <td>
                <strong><%= user.account_firstname %> <%= user.account_lastname %></strong>
              </td>
              <td>
                <a href="mailto:<%= user.account_email %>"><%= user.account_email %></a>
              </td>
              <td>
                <span class="badge badge-<%= user.account_type.toLowerCase() %>">
                  <%= user.account_type || 'Client' %>
                </span>
              </td>
              <td>
                <%= new Date(user.account_created_at).toLocaleDateString() %>
              </td>
              <td>
                <% 
                  let completionItems = 0;
                  if (user.bio) completionItems++;
                  if (user.phone_number) completionItems++;
                  if (user.address) completionItems++;
                  if (user.profile_picture) completionItems++;
                  let completionPercent = (completionItems / 4) * 100;
                %>
                <div class="completion-bar">
                  <div class="completion" style="width: <%= completionPercent %>%"></div>
                </div>
                <span class="completion-text"><%= completionPercent.toFixed(0) %>%</span>
              </td>
              <td>
                <%= user.phone_number ? user.phone_number : '-' %>
              </td>
              <td>
                <button class="btn-small btn-info" onclick="viewUserDetails('<%= user.account_id %>')">View</button>
              </td>
            </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
  <% } else { %>
    <div class="no-data">
      <p>No users found.</p>
    </div>
  <% } %>

  <div class="back-link">
    <a href="/admin/dashboard" class="btn btn-secondary">Back to Dashboard</a>
  </div>
</div>

<!-- User Detail Modal -->
<div id="userModal" class="modal" style="display:none;">
  <div class="modal-content">
    <span class="close" onclick="closeUserModal()">&times;</span>
    <div id="userDetails"></div>
  </div>
</div>

<script>
function viewUserDetails(userId) {
  // Find user data from the page
  const user = <%= JSON.stringify(users) %>.find(u => u.account_id == userId);
  
  if (!user) return;
  
  let html = `
    <h2>${user.account_firstname} ${user.account_lastname}</h2>
    <div class="detail-item">
      <strong>Email:</strong> <a href="mailto:${user.account_email}">${user.account_email}</a>
    </div>
    <div class="detail-item">
      <strong>Account Type:</strong> <span class="badge badge-${user.account_type.toLowerCase()}">${user.account_type}</span>
    </div>
    <div class="detail-item">
      <strong>Member Since:</strong> ${new Date(user.account_created_at).toLocaleDateString()}
    </div>
    
    <h3>Profile Information</h3>
  `;
  
  if (user.profile_id) {
    html += `
      <div class="detail-item">
        <strong>Bio:</strong> ${user.bio || 'Not provided'}
      </div>
      <div class="detail-item">
        <strong>Phone:</strong> ${user.phone_number || 'Not provided'}
      </div>
      <div class="detail-item">
        <strong>Address:</strong> ${user.address || 'Not provided'}
      </div>
      <div class="detail-item">
        <strong>Profile Updated:</strong> ${new Date(user.profile_updated_at).toLocaleDateString()}
      </div>
    `;
  } else {
    html += '<p class="no-profile">No profile created yet</p>';
  }
  
  document.getElementById('userDetails').innerHTML = html;
  document.getElementById('userModal').style.display = 'block';
}

function closeUserModal() {
  document.getElementById('userModal').style.display = 'none';
}

window.onclick = function(event) {
  const modal = document.getElementById('userModal');
  if (event.target === modal) {
    modal.style.display = 'none';
  }
}
</script>

<style>
.admin-users-list {
  padding: 20px;
  background-color: #f5f5f5;
  min-height: 100vh;
}

.admin-users-list h1 {
  color: #333;
  margin-bottom: 20px;
}

.users-stats {
  background-color: white;
  padding: 15px;
  border-radius: 5px;
  margin-bottom: 20px;
  font-weight: 500;
}

.users-table-container {
  background-color: white;
  border-radius: 5px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  overflow-x: auto;
}

.users-table {
  width: 100%;
  border-collapse: collapse;
}

.users-table th {
  background-color: #f8f9fa;
  padding: 12px;
  text-align: left;
  font-weight: 600;
  color: #333;
  border-bottom: 2px solid #dee2e6;
}

.users-table td {
  padding: 12px;
  border-bottom: 1px solid #dee2e6;
}

.users-table tbody tr:hover {
  background-color: #f8f9fa;
}

.badge {
  display: inline-block;
  padding: 4px 8px;
  border-radius: 3px;
  font-size: 0.85rem;
  font-weight: 600;
  color: white;
}

.badge-admin {
  background-color: #dc3545;
}

.badge-employee {
  background-color: #007bff;
}

.badge-client {
  background-color: #6c757d;
}

.completion-bar {
  width: 100px;
  height: 20px;
  background-color: #dee2e6;
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 5px;
}

.completion {
  height: 100%;
  background: linear-gradient(90deg, #28a745, #20c997);
}

.completion-text {
  font-size: 0.85rem;
  color: #666;
}

.btn-small {
  padding: 6px 12px;
  border: none;
  border-radius: 3px;
  cursor: pointer;
  font-weight: 600;
  font-size: 0.85rem;
  transition: background-color 0.3s;
}

.btn-info {
  background-color: #17a2b8;
  color: white;
}

.btn-info:hover {
  background-color: #138496;
}

.no-data {
  background-color: white;
  padding: 30px;
  border-radius: 5px;
  text-align: center;
  color: #999;
}

.back-link {
  margin-top: 20px;
  text-align: center;
}

.btn {
  display: inline-block;
  padding: 10px 20px;
  border-radius: 5px;
  text-decoration: none;
  font-weight: 600;
  transition: background-color 0.3s;
  border: none;
  cursor: pointer;
}

.btn-secondary {
  background-color: #6c757d;
  color: white;
}

.btn-secondary:hover {
  background-color: #5a6268;
}

/* Modal Styles */
.modal {
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
}

.modal-content {
  background-color: white;
  margin: 5% auto;
  padding: 20px;
  border-radius: 5px;
  width: 90%;
  max-width: 500px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
  max-height: 80vh;
  overflow-y: auto;
}

.close {
  float: right;
  font-size: 2rem;
  font-weight: bold;
  cursor: pointer;
  color: #aaa;
}

.close:hover {
  color: #000;
}

.modal-content h2 {
  margin-top: 0;
  color: #333;
  border-bottom: 2px solid #007bff;
  padding-bottom: 10px;
}

.modal-content h3 {
  margin-top: 20px;
  margin-bottom: 10px;
  color: #555;
  font-size: 1rem;
}

.detail-item {
  margin-bottom: 12px;
  padding: 10px;
  background-color: #f8f9fa;
  border-radius: 3px;
}

.no-profile {
  color: #999;
  font-style: italic;
}

@media (max-width: 768px) {
  .users-table {
    font-size: 0.9rem;
  }
  
  .users-table th,
  .users-table td {
    padding: 8px;
  }
}
</style>
